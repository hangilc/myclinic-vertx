<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>受付</title>
    <script src="../vendor/jquery.min.js"></script>
    <link rel="stylesheet" href="../vendor/bootstrap.min.css">
    <script src="../vendor/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="css/modal-dialog.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
</head>
<body class="mt-0 mx-5 mb-5">
<div class="container-fluid">
    <div class="row pt-3 pb-2">
        <h1 class="bg-info text-white p-3 col-md-12">受付</h1>
    </div>
    <div class="row">
        <div class="col-2 pl-0">
            <div class="sidebar p-1 pl-2 mb-2">
                <ul class="list-unstyled menu-elements mb-1">
                    <li><a href="javascript:void(0)" id="index-main-link">メイン</a></li>
                    <li><a href="javascript:void(0)" id="index-patient-management-link">患者管理</a></li>
                    <li><a href="javascript:void(0)" id="index-scan-link">スキャン</a></li>
                </ul>
            </div>
            <div id="index-hotline-part">
                <form class="x-hotline-form" onsubmit="return false;">
                    <div class="mb-2">
                        <textarea rows="3" class="form-control mb-2 x-hotline-input"
                                  style="font-size:80%"></textarea>
                        <button class="btn btn-primary btn-sm" type="submit">送信</button>
                        <button class="btn btn-secondary btn-sm x-roger">了解</button>
                        <button class="btn btn-secondary btn-sm x-beep">Beep</button>
                        <div class="dropdown d-inline-block x-freqs-menu">
                            <button class="btn btn-link btn-sm dropdown-toggle x-hotlinie-freqs"
                                    data-toggle="dropdown">常用
                            </button>
                            <div class="dropdown-menu">
                                <a class="dropdown-item" href="javascript:void(0)">おはようございます。</a>
                                <a class="dropdown-item" href="javascript:void(0)">退出します。</a>
                                <a class="dropdown-item" href="javascript:void(0)">戻りました。</a>
                                <a class="dropdown-item" href="javascript:void(0)">検温中です。</a>
                                <a class="dropdown-item" href="javascript:void(0)">体温 {} 度でした。</a>
                                <a class="dropdown-item" href="javascript:void(0)">胃腸の調子が悪いそうです。</a>
                                <a class="dropdown-item" href="javascript:void(0)">相談です。</a>
                                <a class="dropdown-item" href="javascript:void(0)">セットできました。</a>
                                <a class="dropdown-item" href="javascript:void(0)">お薬手帳忘れです。</a>
                                <a class="dropdown-item" href="javascript:void(0)">面会の方いらしてます。</a>
                            </div>
                        </div>
                        <button class="btn btn-link btn-sm x-hotlinie-patients">患者</button>
                    </div>
                </form>
                <div class="border border-secondary rounded p-2 x-hotline-list"
                     style="max-height: 20em; overflow-y: auto; font-size:80%"></div>
            </div>
        </div>

        <div class="col-10 pr-0" id="index-pane-wrapper"></div>
    </div>
</div>
<script>
    window.onerror = message => alert(message);

    (async function () {
        let {Menu} = await import("./index-menu.js");
        let {MainPanel} = await import("./main/main-panel.js");
        let {PatientManagementPanel} = await import("./patient-management/patient-management-panel.js");
        let {ScanPanel} = await import("./scan/scan-panel.js");
        let {Rest} = await import("./js/rest.js");
        let {PrintAPI} = await import("../js/print-api.js");
        let {HotlineController} = await import("../hotline/hotline-controller.js");
        let {parseElement} = await import("./js/parse-node.js");

        let rest = new Rest("/json");
        let printAPI = new PrintAPI("http://127.0.0.1:48080");
        let menu = new Menu(document.getElementById("index-pane-wrapper"));
        menu.addItem("main", e => {
                let panel = new MainPanel(e, rest);
                return {
                    reloadHook: async () => await panel.reloadHook()
                };
            },
            document.getElementById("index-main-link"));
        menu.addItem("patient-management", e => {
                let panel = new PatientManagementPanel(rest);
                e.appendChild(panel.ele);
                return {};
            },
            document.getElementById("index-patient-management-link"));
        menu.addItem("scan", e => {
                let panel = new ScanPanel(rest, printAPI);
                e.appendChild(panel.ele);
                return {
                    reloadHook: async () => await panel.reloadHook(),
                    postConstruct: async () => await panel.postConstruct()
                };
            },
            document.getElementById("index-scan-link"));
        await menu.simulateClick("main");

        let hotlineMap = parseElement(document.getElementById("index-hotline-part"));
        let hotlineController = new HotlineController("reception", "practice",
            hotlineMap.hotlineList, rest, printAPI);
        await hotlineController.init();
        hotlineMap.hotlineForm.addEventListener("submit", async event => {
            let m = hotlineMap.hotlineInput.value.trim();
            if (m !== "") {
                await hotlineController.submit(m);
            }
            hotlineMap.hotlineInput.value = "";
        });
        hotlineMap.roger.addEventListener("click", async event => {
            await hotlineController.submit("了解");
        });
        hotlineMap.beep.addEventListener("click", async event => {
            await hotlineController.sendBeep();
        });
        hotlineMap.freqsMenu.querySelectorAll(".dropdown-item").forEach(e => {
            e.addEventListener("click", async event => {
                let text = event.target.innerText;
                await hotlineController.submit(text);
            });
        });

    })
    ();
</script>
</body>
</html>