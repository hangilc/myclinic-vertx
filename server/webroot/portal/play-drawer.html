<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="js/jquery.min.js"></script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <title>Play Drawer</title>
    <script type="module">
        import {drawerToSvg} from "./js/drawer-svg.js";
        window.drawerToSvg = drawerToSvg;
    </script>
</head>
<body>
    <div class="row m-3">
        <div class="col-lg-5">
            <textarea class="form-control x-ops" rows="20">
[
["create_pen", "solid", 0, 0, 0, 0, 0],
["create_pen", "dash", 0, 0, 0, 0, 1],
["create_pen", "dot", 0, 0, 0, 0, 2],
["create_pen", "dashdot", 0, 0, 0, 0, 3],
["create_pen", "dashdotdot", 0, 0, 0, 0, 4],
["create_pen", "null", 0, 0, 0, 0, 5],
["create_pen", "insideframe", 0, 0, 0, 0, 6],
["set_pen", "solid"],
["move_to", 10, 10],
["line_to", 80, 10],
["set_pen", "dash"],
["move_to", 10, 20],
["line_to", 80, 20],
["set_pen", "dot"],
["move_to", 10, 30],
["line_to", 80, 30],
["set_pen", "dashdot"],
["move_to", 10, 40],
["line_to", 80, 40],
["set_pen", "dashdotdot"],
["move_to", 10, 50],
["line_to", 80, 50],
["set_pen", "null"],
["move_to", 10, 60],
["line_to", 80, 60],
["set_pen", "insideframe"],
["move_to", 10, 70],
["line_to", 80, 70]
]
            </textarea>
            <div class="mt-2">
                <button type="button" class="btn btn-primary x-view-button">表示</button>
                <button type="button" class="btn btn-secondary ml-2 x-print-button">印刷</button>
            </div>
        </div>
        <div class="col-lg-7">
            <div id="viewer" class="p-1 m-0"></div>
        </div>
    </div>
<script>

    $(".x-view-button").on("click", event => {
        let ops = JSON.parse($("textarea.x-ops").val());
        $("#viewer").html("").append(drawerToSvg(ops, {
            width: "105mm",
            height: "150mm",
            viewBox: "0, 0, 210, 297"
        }));
    });

    $(".x-print-button").on("click", event => {
        let ops = JSON.parse($("textarea.x-ops").val());
        let data = JSON.stringify([ops]);
        $.ajax({
            type: "POST",
            url: "../json/print-drawer",
            data: data,
            processData: false,
            error: (xhr, status, err) => {
                let msg = xhr.responseText + " : " + err.toString() + " : " + status;
                alert(msg);
                fail(msg);
            }
        });
    });



    // $("button").on("click", event => {
    //     let data = {};
    //     $.ajax({
    //         type: "POST",
    //         url: "../json/view-drawer",
    //         data: data,
    //         success: function(html){
    //             let w = window.open("about:blank", "_blank");
    //             w.document.open();
    //             w.document.write(html);
    //             w.document.close();
    //         }
    //     })
    // });

</script>
</body>
</html>