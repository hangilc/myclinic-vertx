<!DOCTYPE html>
<html>
<head>
    <title>Myclinic Portal</title>
    <meta charset="UTF-8">
    <script>$$ = {};</script>
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <script src="js/jquery.min.js"></script>
    <script src="js/moment.min.js"></script>
    <script src="js/common.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script type="module">
        import * as kanjidate from "./js/kanjidate.js";
        window.kanjidate = kanjidate;
    </script>
    <link rel="stylesheet" href="css/main.css">
    <meta name="viewport" content="width=device-width, initial-scale=1">
</head>
<body class="pb-5">
<div class="container">
    <div class="row pt-3 pb-2">
        <h1 class="bg-dark text-white p-3 col-md-12">Myclinic Portal</h1>
    </div>
</div>

<div class="container">

    <div class="row">
        <div class="col-xl-2 sidebar">
            <ul class="list-unstyled menu-elements mt-1">
                <li><a href="javascript:void(0)" class="scroll-link" id="index-practice-link">診察</a></li>
                <li><a href="javascript:void(0)" class="scroll-link" id="index-cashier-link">会計</a></li>
                <li><a href="javascript:void(0)" class="scroll-link" id="index-reception-link">受付</a></li>
                <li><a href="javascript:void(0)" class="scroll-link" id="index-faxed-link">ファックス済処方箋</a></li>
                <li><a href="javascript:void(0)" class="scroll-link" id="index-houmon-kango-link">訪問看護</a></li>
                <li><a href="javascript:void(0)" class="scroll-link" id="index-send-fax-link">ファックス送信</a></li>
            </ul>
        </div>

        <div class="col-xl-10" id="index-pane-wrapper"></div>

    </div>
</div>

<script>

    let rest = new Rest("../json");
    let integration = new Integration("../integration");

    window.onerror = message => alert(message);

    (function(){
        let paneWrapper = $("#index-pane-wrapper");
        let currentPane = null;

        class Pane {
            constructor(link, url){
                this.link = link;
                this.url = url;
                this.ele = null;
                link.on("click", event => this.load());
            }

            save(){
                this.ele = paneWrapper.contents().detach();
            }

            async initPane(){

            }

            onPaneLoaded(){
                paneWrapper.find(".pane").trigger("pane_shown");
                $(".sidebar a.active").removeClass("active");
                this.link.addClass("active");
            }

            async load(){
                if( currentPane ){
                    currentPane.save();
                }
                if( this.ele ){
                    paneWrapper.append(this.ele);
                    currentPane = this;
                    this.onPaneLoaded();
                } else {
                    paneWrapper.load(this.url, async () => {
                        currentPane = this;
                        await this.initPane();
                        this.onPaneLoaded();
                    });
                }
            }
        }

        class PracticePane extends Pane {
            constructor(){
                super($("#index-practice-link"), "pane-practice.html");
            }
        }

        class CashierPane extends Pane {
            constructor(){
                super($("#index-cashier-link"), "pane-cashier.html");
            }

            async initPane(){
                await super.initPane();
                await initCashier();
            }
        }

        class FaxedShohousenPane extends Pane {
            constructor(){
                super($("#index-faxed-link"), "pane-faxed-shohousen.html");
            }
        }

        class ReceptionPane extends Pane {
            constructor(){
                super($("#index-reception-link"), "pane-reception.html");
            }

            async initPane(){
                await super.initPane();
                await initReception();
            }
        }

        class HoumonKangoPane extends Pane {
            constructor(){
                super($("#index-houmon-kango-link"), "pane-houmon-kango.html");
            }
        }

        class SendFaxPane extends Pane {
            constructor(){
                super($("#index-send-fax-link"), "pane-send-fax.html");
            }
        }

        let practice = new PracticePane();
        let cashier = new CashierPane();
        let reception = new ReceptionPane();
        let faxedShohousen = new FaxedShohousenPane();
        let houmonKango = new HoumonKangoPane();
        let sendFax = new SendFaxPane();

        reception.link.click();
    })();

    // (function(){
    //     let currentPaneId = "";
    //     let paneMap = {};
    //
    //     function setActive(e){
    //         $(".sidebar a.active").removeClass("active");
    //         e.addClass("active");
    //     }
    //
    //     function loadPane(id, url, wrapperElement){
    //         return new Promise((resolve, fail) => {
    //             if( id in paneMap ){
    //                 wrapperElement.append(paneMap[id]);
    //                 delete paneMap[id];
    //                 resolve(false);
    //             } else {
    //                 wrapperElement.load(url, async () => {
    //                     if( id === "index-reception-link" ){
    //                         await initReception();
    //                     }
    //                     resolve(true);
    //                 });
    //             }
    //         });
    //     }
    //
    //     async function onLinkClicked(id, url){
    //         let wrapper = $("#index-pane-wrapper");
    //         if( id === currentPaneId ){
    //             return;
    //         }
    //         if( currentPaneId !== "" ){
    //             paneMap[currentPaneId] = wrapper.contents().detach();
    //         }
    //         let fetched = await loadPane(id, url, wrapper);
    //         currentPaneId = id;
    //         //if( !fetched ) {
    //             wrapper.find(".pane").trigger("pane_shown");
    //             console.log("triggered");
    //         //}
    //         setActive($(this));
    //
    //     }
    //
    //     function bindLink(id, url){
    //         $(`#${id}`).on("click", event => onLinkClicked(id, url));
    //     }
    //
    //     bindLink("index-practice-link", "pane-practice.html");
    //     bindLink("index-cashier-link", "pane-cashier.html");
    //     bindLink("index-reception-link", "pane-reception.html");
    //     bindLink("index-faxed-link", "pane-faxed-shohousen.html");
    //     bindLink("index-houmon-kango-link", "pane-houmon-kango.html");
    //     bindLink("index-send-fax-link", "pane-send-fax.html");
    //     $("#index-reception-link").click();
    // })();

</script>
</body>
</html>
