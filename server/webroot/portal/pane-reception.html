<h3>受付</h3>

<div id="reception-main-commands">
    <button type="button" class="btn btn-secondary x-new-patient">新規患者</button>
    <button type="button" class="btn btn-secondary x-search-patient ml-2">患者検索</button>
    <button type="button" class="btn btn-secondary x-search-payment ml-2">会計検索</button>
    <button type="button" class="btn btn-secondary x-search-receipt-paper ml-2">領収書用紙</button>
</div>

<div id="reception-commands-second-row">
    <div class="form-inline mt-2">
        患者番号：<input type="text" class="form-control" />
        <button class="btn btn-secondary ml-2">診療受付</button>
        <button class="btn btn-secondary ml-2">患者情報</button>
    </div>
</div>

<table class="table mt-3" id="reception-wqueue-table">
    <thead>
        <tr>
            <th scope="col">状態</th>
            <th scope="col">ID</th>
            <th scope="col">氏名</th>
            <th scope="col">よみ</th>
            <th scope="col">性別</th>
            <th scope="col">生年月日</th>
            <th scope="col">年齢</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>診待</td>
            <th scope="row">123</th>
            <td>診療 太郎</td>
            <td>しんりょう たろう</td>
            <td>男</td>
            <td>昭和12年1月2日</td>
            <td>72才</td>
        </tr>
        <tr class="table-active">
            <td>診待</td>
            <th scope="row">123</th>
            <td>診療 太郎</td>
            <td>しんりょう たろう</td>
            <td>男</td>
            <td>昭和12年1月2日</td>
            <td>72才</td>
        </tr>
        <tr>
            <td>診待</td>
            <th scope="row">123</th>
            <td>診療 太郎</td>
            <td>しんりょう たろう</td>
            <td>男</td>
            <td>昭和12年1月2日</td>
            <td>72才</td>
        </tr>
        <tr>
            <td>診待</td>
            <th scope="row">123</th>
            <td>診療 太郎</td>
            <td>しんりょう たろう</td>
            <td>男</td>
            <td>昭和12年1月2日</td>
            <td>72才</td>
        </tr>
    </tbody>
</table>

<div id="reception-bottom-commands" class="form-inline">
    <button type="button" class="btn btn-secondary x-refresh">更新</button>
    <button type="button" class="btn btn-secondary ml-2 x-cashier">会計</button>
    <button type="button" class="btn btn-secondary ml-2 x-deselection">選択解除</button>
    <button type="button" class="btn btn-secondary ml-2 x-delete">削除</button>
</div>

<template id="reception-search-patient-dialog-content-template">
    <div class="x-body_">
        <form class="form-inline x-form">
            <input type="text" class="form-control x-search-text"/>
            <button type="submit" class="btn btn-secondary ml-2">検索</button>
            <button type="submit" class="btn btn-secondary ml-2">最近の登録</button>
        </form>
        <select size="10" class="x-select form-control mt-3"></select>
    </div>
    <div class="x-footer_">
        <div class="row">
            <div class="col-sm-9">
                <div class="row x-disp_">
                    <div class="col-sm-4">患者番号：</div>
                        <div class="col-sm-8 x-patient-id"></div>
                    <div class="col-sm-4">氏名：</div>
                        <div class="col-sm-8">
                            <span class="x-last-name"></span>
                            <span class="x-first-name"></span>
                        </div>
                    <div class="col-sm-4">よみ：</div>
                        <div class="col-sm-8">
                            <span class="x-last-name-yomi"></span>
                            <span class="x-first-name-yomi"></span>
                        </div>
                    <div class="col-sm-4">生年月日：</div>
                        <div class="col-sm-8 x-birthday"></div>
                    <div class="col-sm-4">性別：</div>
                        <div class="col-sm-8 x-sex"></div>
                    <div class="col-sm-4">住所：</div>
                        <div class="col-sm-8 x-address"></div>
                    <div class="col-sm-4">電話番号：</div>
                        <div class="col-sm-8 x-phone"></div>
                </div>
            </div>
            <div class="col-sm-3 form">
                <button type="submit" class="btn btn-secondary btn-block">編集</button>
                <button type="submit" class="btn btn-secondary btn-block mt-2">診療受付</button>
            </div>
        </div>
    </div>
</template>

<script>
    (async function(){
        let {parseElement} = await import("./js/parse-element.js");
        let {createDialog} = await import("./reception/dialog.js");
        let SearchPatientDialog = await import("./reception/search-patient-dialog.js");

        class DialogFactory {
            create(){

            }
        }

        (function(){
            let ele = $("#reception-main-commands");
            let map = parseElement(ele);

            map.newPatient.on("click", event => {
                alert("new patient: not supported");
            });

            map.searchPatient.on("click", async event => {
                let html = $("template#reception-search-patient-dialog-content-template").html();
                let ele = $(html);
                let map = parseElement(ele);
                let body = new SearchPatientDialog.Body(map.body_, map.body, rest).init().set();
                let footer = new SearchPatientDialog.Footer(map.footer_, map.footer, rest).init().set();
                body.onSelected(patient => footer.set(patient));
                let dialog = createDialog(rest, "患者検索", body, footer);
                dialog.ele.on("shown.bs.modal", event => body.focus());
                let result = await dialog.open();
            });
        })();
    })();
</script>